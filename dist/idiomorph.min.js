var Idiomorph=function(){"use strict";const e=()=>{};const n={morphStyle:"outerHTML",callbacks:{beforeNodeAdded:e,afterNodeAdded:e,beforeNodeMorphed:e,afterNodeMorphed:e,beforeNodeRemoved:e,afterNodeRemoved:e,beforeAttributeUpdated:e},head:{style:"merge",shouldPreserve:e=>e.getAttribute("im-preserve")==="true",shouldReAppend:e=>e.getAttribute("im-re-append")==="true",shouldRemove:e,afterHeadMorphed:e},restoreFocus:true};function t(t,e,n={}){t=u(t);const o=f(e);const r=d(t,o,n);const i=a(r,()=>{return s(r,t,o,e=>{if(e.morphStyle==="innerHTML"){c(e,t,o);return Array.from(t.childNodes)}else{return l(e,t,o)}})});r.pantry.remove();return i}function l(e,t,n){const o=f(t);let r=Array.from(o.childNodes);const i=r.indexOf(t);const l=r.length-(i+1);c(e,o,n,t,t.nextSibling);r=Array.from(o.childNodes);return r.slice(i,r.length-l)}function a(e,t){if(!e.config.restoreFocus)return t();let n=document.activeElement;if(!(n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement)){return t()}const{id:o,selectionStart:r,selectionEnd:i}=n;const l=t();if(o&&o!==document.activeElement?.id){n=e.target.querySelector(`#${o}`);n?.focus()}if(n&&!n.selectionEnd&&i){n.setSelectionRange(r,i)}return l}const c=function(){function e(e,t,n,o=null,r=null){if(t instanceof HTMLTemplateElement&&n instanceof HTMLTemplateElement){t=t.content;n=n.content}o||=t.firstChild;for(const i of n.childNodes){if(o&&o!=r){const a=u(e,i,o,r);if(a){if(a!==o){m(e,o,a)}p(a,i,e);o=a.nextSibling;continue}}if(i instanceof Element&&e.persistentIds.has(i.id)){const c=h(t,i.id,o,e);p(c,i,e);o=c.nextSibling;continue}const l=d(t,i,o,e);if(l){o=l.nextSibling}}while(o&&o!=r){const s=o;o=o.nextSibling;f(e,s)}}function d(e,t,n,o){if(o.callbacks.beforeNodeAdded(t)===false)return null;if(o.idMap.has(t)){const r=document.createElement(t.tagName);e.insertBefore(r,n);p(r,t,o);o.callbacks.afterNodeAdded(r);return r}else{const i=document.importNode(t,true);e.insertBefore(i,n);o.callbacks.afterNodeAdded(i);return i}}const u=function(){function e(e,t,n,o){let r=null;let i=t.nextSibling;let l=0;let a=n;while(a&&a!=o){if(s(a,t)){if(c(e,a,t)){return a}if(r===null){if(!e.idMap.has(a)){r=a}}}if(r===null&&i&&s(a,i)){l++;i=i.nextSibling;if(l>=2){r=undefined}}if(a.contains(document.activeElement))break;a=a.nextSibling}return r||null}function c(e,t,n){let o=e.idMap.get(t);let r=e.idMap.get(n);if(!r||!o)return false;for(const i of o){if(r.has(i)){return true}}return false}function s(e,t){const n=e;const o=t;return n.nodeType===o.nodeType&&n.tagName===o.tagName&&(!n.id||n.id===o.id)}return e}();function f(e,t){if(e.idMap.has(t)){l(e.pantry,t,null)}else{if(e.callbacks.beforeNodeRemoved(t)===false)return;t.parentNode?.removeChild(t);e.callbacks.afterNodeRemoved(t)}}function m(t,e,n){let o=e;while(o&&o!==n){let e=o;o=o.nextSibling;f(t,e)}return o}function h(e,t,n,o){const r=o.target.querySelector(`#${t}`)||o.pantry.querySelector(`#${t}`);i(r,o);l(e,r,n);return r}function i(t,n){const o=t.id;while(t=t.parentNode){let e=n.idMap.get(t);if(e){e.delete(o);if(!e.size){n.idMap.delete(t)}}}}function l(t,n,o){if(t.moveBefore){try{t.moveBefore(n,o)}catch(e){t.insertBefore(n,o)}}else{t.insertBefore(n,o)}}return e}();const p=function(){function e(e,t,n){if(n.ignoreActive&&e===document.activeElement){return null}if(n.callbacks.beforeNodeMorphed(e,t)===false){return e}if(e instanceof HTMLHeadElement&&n.head.ignore){}else if(e instanceof HTMLHeadElement&&n.head.style!=="morph"){m(e,t,n)}else{o(e,t,n);if(!f(e,n)){c(n,e,t)}}n.callbacks.afterNodeMorphed(e,t);return e}function o(e,t,n){let o=t.nodeType;if(o===1){const r=e;const i=t;const l=r.attributes;const a=i.attributes;for(const c of a){if(u(c.name,r,"update",n)){continue}if(r.getAttribute(c.name)!==c.value){r.setAttribute(c.name,c.value)}}for(let e=l.length-1;0<=e;e--){const s=l[e];if(!s)continue;if(!i.hasAttribute(s.name)){if(u(s.name,r,"remove",n)){continue}r.removeAttribute(s.name)}}if(!f(r,n)){d(r,i,n)}}if(o===8||o===3){if(e.nodeValue!==t.nodeValue){e.nodeValue=t.nodeValue}}}function d(n,o,r){if(n instanceof HTMLInputElement&&o instanceof HTMLInputElement&&o.type!=="file"){let e=o.value;let t=n.value;i(n,o,"checked",r);i(n,o,"disabled",r);if(!o.hasAttribute("value")){if(!u("value",n,"remove",r)){n.value="";n.removeAttribute("value")}}else if(t!==e){if(!u("value",n,"update",r)){n.setAttribute("value",e);n.value=e}}}else if(n instanceof HTMLOptionElement&&o instanceof HTMLOptionElement){i(n,o,"selected",r)}else if(n instanceof HTMLTextAreaElement&&o instanceof HTMLTextAreaElement){let e=o.value;let t=n.value;if(u("value",n,"update",r)){return}if(e!==t){n.value=e}if(n.firstChild&&n.firstChild.nodeValue!==e){n.firstChild.nodeValue=e}}}function i(e,t,n,o){const r=t[n],i=e[n];if(r!==i){const l=u(n,e,"update",o);if(!l){e[n]=t[n]}if(r){if(!l){e.setAttribute(n,"")}}else{if(!u(n,e,"remove",o)){e.removeAttribute(n)}}}}function u(e,t,n,o){if(e==="value"&&o.ignoreActiveValue&&t===document.activeElement){return true}return o.callbacks.beforeAttributeUpdated(e,t,n)===false}function f(e,t){return!!t.ignoreActiveValue&&e===document.activeElement&&e!==document.body}return e}();function s(t,e,n,o){if(t.head.block){const r=e.querySelector("head");const i=n.querySelector("head");if(r&&i){const l=m(r,i,t);return Promise.all(l).then(()=>{const e=Object.assign(t,{head:{block:false,ignore:true}});return o(e)})}}return o(t)}function m(e,t,o){let r=[];let i=[];let l=[];let a=[];let c=new Map;for(const n of t.children){c.set(n.outerHTML,n)}for(const d of e.children){let e=c.has(d.outerHTML);let t=o.head.shouldReAppend(d);let n=o.head.shouldPreserve(d);if(e||n){if(t){i.push(d)}else{c.delete(d.outerHTML);l.push(d)}}else{if(o.head.style==="append"){if(t){i.push(d);a.push(d)}}else{if(o.head.shouldRemove(d)!==false){i.push(d)}}}}a.push(...c.values());let s=[];for(const u of a){let n=document.createRange().createContextualFragment(u.outerHTML).firstChild;if(o.callbacks.beforeNodeAdded(n)!==false){if("href"in n&&n.href||"src"in n&&n.src){let t;let e=new Promise(function(e){t=e});n.addEventListener("load",function(){t()});s.push(e)}e.appendChild(n);o.callbacks.afterNodeAdded(n);r.push(n)}}for(const f of i){if(o.callbacks.beforeNodeRemoved(f)!==false){e.removeChild(f);o.callbacks.afterNodeRemoved(f)}}o.head.afterHeadMorphed(e,{added:r,kept:l,removed:i});return s}const d=function(){function e(e,t,n){const{persistentIds:o,idMap:r}=u(e,t);const i=a(n);const l=i.morphStyle||"outerHTML";if(!["innerHTML","outerHTML"].includes(l)){throw`Do not understand how to morph style ${l}`}return{target:e,newContent:t,config:i,morphStyle:l,ignoreActive:i.ignoreActive,ignoreActiveValue:i.ignoreActiveValue,restoreFocus:i.restoreFocus,idMap:r,persistentIds:o,pantry:c(),callbacks:i.callbacks,head:i.head}}function a(e){let t=Object.assign({},n);Object.assign(t,e);t.callbacks=Object.assign({},n.callbacks,e.callbacks);t.head=Object.assign({},n.head,e.head);return t}function c(){const e=document.createElement("div");e.hidden=true;document.body.insertAdjacentElement("afterend",e);return e}function s(e){let t=Array.from(e.querySelectorAll("[id]"));if(e.id){t.push(e)}return t}function d(n,e,o,t){for(const r of t){if(e.has(r.id)){let t=r;while(t){let e=n.get(t);if(e==null){e=new Set;n.set(t,e)}e.add(r.id);if(t===o)break;t=t.parentElement}}}}function u(e,t){const n=s(e);const o=s(t);const r=f(n,o);let i=new Map;d(i,r,e,n);const l=t.__idiomorphRoot||t;d(i,r,l,o);return{persistentIds:r,idMap:i}}function f(e,t){let n=new Set;let o=new Map;for(const{id:i,tagName:l}of e){if(o.has(i)){n.add(i)}else{o.set(i,l)}}let r=new Set;for(const{id:i,tagName:l}of t){if(r.has(i)){n.add(i)}else if(o.get(i)===l){r.add(i)}}for(const i of n){r.delete(i)}return r}return e}();const{normalizeElement:u,normalizeParent:f}=function(){const r=new WeakSet;function e(e){if(e instanceof Document){return e.documentElement}else{return e}}function o(e){if(e==null){return document.createElement("div")}else if(typeof e==="string"){return o(l(e))}else if(r.has(e)){return e}else if(e instanceof Node){if(e.parentNode){return i(e)}else{const t=document.createElement("div");t.append(e);return t}}else{const t=document.createElement("div");for(const n of[...e]){t.append(n)}return t}}function i(n){return{childNodes:[n],querySelectorAll:e=>{const t=n.querySelectorAll(e);return n.matches(e)?[n,...t]:t},insertBefore:(e,t)=>n.parentNode.insertBefore(e,t),moveBefore:(e,t)=>n.parentNode.moveBefore(e,t),get __idiomorphRoot(){return n}}}function l(n){let o=new DOMParser;let e=n.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(e.match(/<\/html>/)||e.match(/<\/head>/)||e.match(/<\/body>/)){let t=o.parseFromString(n,"text/html");if(e.match(/<\/html>/)){r.add(t);return t}else{let e=t.firstChild;if(e){r.add(e)}return e}}else{let e=o.parseFromString("<body><template>"+n+"</template></body>","text/html");let t=e.body.querySelector("template").content;r.add(t);return t}}return{normalizeElement:e,normalizeParent:o}}();return{morph:t,defaults:n}}();